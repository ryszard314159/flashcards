<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Pro</title>
    <meta name="theme-color" content="#2196F3">
    <style>
        :root { --primary: #2196F3; --bg: #f5f5f5; --text: #333; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; color: var(--text); overflow: hidden; }
        header { background: var(--primary); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100; }
        #importer { padding: 2rem; text-align: center; border: 2px dashed #ccc; margin: 2rem; border-radius: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .app-container { position: relative; flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; max-width: 600px; margin: 0 auto; }
        .nav-arrow { background: none; border: none; font-size: 2.8rem; color: #bbb; cursor: pointer; padding: 0.5rem; transition: color 0.2s, transform 0.1s; z-index: 50; user-select: none; -webkit-tap-highlight-color: transparent; }
        .nav-arrow:active { transform: scale(0.85); color: var(--primary); }
        .card-container { perspective: 1000px; width: 70%; height: 340px; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); background: white; box-sizing: border-box; }
        .card-back { transform: rotateY(180deg); background: #f0f7ff; border: 2px solid var(--primary); }
        .category-label { font-size: 0.75rem; color: var(--primary); font-weight: bold; position: absolute; top: 1.5rem; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.7; }
        .phrase { font-size: 1.5rem; font-weight: bold; line-height: 1.3; color: #222; margin-bottom: 1.5rem; }
        .speaker-btn { background: #eee; color: #444; border: none; width: 45px; height: 45px; border-radius: 50%; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; border: 1px solid #ddd; }
        .speaker-btn:active { transform: scale(0.9); background: var(--primary); color: white; }
        .utility-footer { display: flex; justify-content: center; padding: 1.5rem; }
        .btn-shuffle { background: #607D8B; color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .btn-outline { background: rgba(255,255,255,0.2); border: 1px solid white; font-size: 0.75rem; padding: 0.4rem 0.8rem; color: white; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div id="status">0 / 0</div>
    <div style="display: flex; gap: 8px;">
        <button class="btn-outline" id="clearBtn" style="display:none" onclick="clearDeck()">Clear</button>
        <button class="btn-outline" onclick="document.getElementById('fileInput').click()">+ Add</button>
    </div>
    <input type="file" id="fileInput" hidden accept=".txt">
</header>

<div id="importer">
    <h2>Flashcard Engine</h2>
    <p>Import your <b>.txt</b> file.</p>
</div>

<div class="app-container" id="appView" style="display:none">
    <button class="nav-arrow" onclick="prevCard()">&#10094;</button>
    <div class="card-container" id="cardCont" onclick="handleCardClick(event)">
        <div class="card-inner" id="cardInner">
            <div class="card-face card-front">
                <span class="category-label" id="catFront"></span>
                <div class="phrase" id="engDisplay"></div>
                <button class="speaker-btn" data-lang="en">ðŸ”Š</button>
            </div>
            <div class="card-face card-back">
                <span class="category-label" id="catBack"></span>
                <div class="phrase" id="spaDisplay"></div>
                <button class="speaker-btn" data-lang="es">ðŸ”Š</button>
            </div>
        </div>
    </div>
    <button class="nav-arrow" onclick="nextCard()">&#10095;</button>
</div>

<div class="utility-footer" id="utilFooter" style="display:none">
    <button class="btn-shuffle" onclick="shuffleDeck()">Shuffle All ðŸ”€</button>
</div>

<script>
    let flashcards = [];
    let currentIndex = 0;
    const synth = window.speechSynthesis;

    window.onload = () => {
        const savedData = localStorage.getItem('myFlashcards');
        if (savedData) {
            flashcards = JSON.parse(savedData);
            if (flashcards.length > 0) startApp();
        }
    };

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => parseAndAdd(e.target.result);
        reader.readAsText(file);
        this.value = ''; 
    });

    function parseAndAdd(text) {
        const lines = text.split('\n');
        let currentCatEng = "General";
        let currentCatSpa = "General";
        let newCards = [];

        lines.forEach(line => {
            const trimmed = line.trim();
            if (trimmed.startsWith('*')) {
                const catPart = trimmed.replace('*', '').trim();
                if (catPart.includes('|')) {
                    const [en, es] = catPart.split('|');
                    currentCatEng = en.trim();
                    currentCatSpa = es.trim();
                } else {
                    currentCatEng = currentCatSpa = catPart;
                }
            } else if (trimmed.includes('|')) {
                const [enPhrase, esPhrase] = trimmed.split('|');
                if(enPhrase && esPhrase) {
                    newCards.push({ 
                        catEn: currentCatEng, 
                        catEs: currentCatSpa, 
                        eng: enPhrase.trim(), 
                        spa: esPhrase.trim() 
                    });
                }
            }
        });
        if (newCards.length === 0) return alert("No valid cards found.");
        flashcards = [...flashcards, ...newCards];
        localStorage.setItem('myFlashcards', JSON.stringify(flashcards));
        startApp();
    }

    function handleCardClick(e) {
        const audioBtn = e.target.closest('.speaker-btn');
        if (audioBtn) {
            e.stopPropagation(); 
            const lang = audioBtn.getAttribute('data-lang');
            const text = (lang === 'en') ? flashcards[currentIndex].eng : flashcards[currentIndex].spa;
            speak(text, lang);
        } else {
            document.getElementById('cardInner').classList.toggle('is-flipped');
        }
    }

    function speak(text, langCode) {
        if (synth.speaking) synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        const voices = synth.getVoices();
        const voice = voices.find(v => v.lang.startsWith(langCode));
        if (voice) utter.voice = voice;
        utter.rate = 0.95; 
        synth.speak(utter);
    }

    function startApp() {
        document.getElementById('importer').style.display = 'none';
        document.getElementById('appView').style.display = 'flex';
        document.getElementById('utilFooter').style.display = 'flex';
        document.getElementById('clearBtn').style.display = 'inline-block';
        updateCard();
    }

    function updateCard() {
        if (flashcards.length === 0) return;
        const card = flashcards[currentIndex];
        document.getElementById('cardInner').classList.remove('is-flipped');
        
        setTimeout(() => {
            document.getElementById('catFront').innerText = card.catEn;
            document.getElementById('catBack').innerText = card.catEs;
            document.getElementById('engDisplay').innerText = card.eng;
            document.getElementById('spaDisplay').innerText = card.spa;
            document.getElementById('status').innerText = `${currentIndex + 1} / ${flashcards.length}`;
        }, 150);
    }

    function nextCard() { currentIndex = (currentIndex + 1) % flashcards.length; updateCard(); }
    function prevCard() { currentIndex = (currentIndex - 1 + flashcards.length) % flashcards.length; updateCard(); }
    function shuffleDeck() {
        for (let i = flashcards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [flashcards[i], flashcards[j]] = [flashcards[j], flashcards[i]];
        }
        currentIndex = 0;
        updateCard();
    }
    function clearDeck() {
        if(confirm("Clear all cards?")) {
            localStorage.removeItem('myFlashcards');
            location.reload();
        }
    }
    window.speechSynthesis.getVoices();
</script>
</body>
</html>